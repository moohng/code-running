var t=Object.defineProperty,e=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,c=(e,o,r)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r;const a=t=>{const a=tui.Toast.loading("");return axios.post("https://ff827abe-e27d-48d4-a09a-81355a2ce85d.bspapp.com/path/add",(s=((t,e)=>{for(var o in e||(e={}))n.call(e,o)&&c(t,o,e[o]);if(r)for(var o of r(e))i.call(e,o)&&c(t,o,e[o]);return t})({},t),l={createTime:Date.now()},e(s,o(l)))).then((({status:t})=>{if(200!==t)throw new Error})).catch((()=>{tui.Toast.error("网络开小差了，请重试~")})).finally(a);var s,l};const s=document.querySelector("#canvas");s.width=innerWidth,s.height=innerHeight;let l="#000000",d="#ffffff",h=6;const u=s.getContext("2d"),p=new class{constructor(t,e="#000000",o=6){this.ctx=t,this.isPlay=!1,this.isComplete=!1,this.background="#fff",this.ctx.lineCap="round",this.ctx.lineJoin="round",this.color=e,this.width=o}set color(t){this.ctx.strokeStyle=t||"#000000"}get color(){return this.ctx.strokeStyle}set width(t){this.ctx.lineWidth=t||6}get width(){return this.ctx.lineWidth}set background(t){this.ctx.fillStyle=t||"#ffffff",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}get background(){return this.ctx.fillStyle}drawLine(t,e){return this.restarting&&(this.restarting=!1,this.ctx.moveTo(t,e),this.ctx.beginPath()),this.ctx.lineTo(t,e),this.ctx.stroke(),this}end(){return this.restarting=!0,this.ctx.closePath(),this}clear(){const{width:t,height:e}=this.ctx.canvas;this.ctx.clearRect(0,0,t,e),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}drawPath(t){this.clear(),t.forEach((({pos:t,color:e,width:o})=>{this.width=o,this.color=e,t.forEach((({x:t,y:e})=>{this.drawLine(t,e)})),this.end()}))}async playPath(t){if(console.log("path",t),!t.length)return Promise.resolve();this.isPlay=!0,this.isComplete=!1,this.clear(),await new Promise((e=>{let o=0,r=0;const n=({x:t,y:e})=>{this.drawLine(t,e),requestAnimationFrame(i)},i=()=>{if(!this.isPlay)return requestAnimationFrame(i);if(r>=t[o].pos.length){if(this.end(),!(++o<t.length))return this.isComplete=!0,e(void 0);r=0,this.color=t[o].color,this.width=t[o].width,setTimeout((()=>{n(t[o].pos[r++])}),240)}else n(t[o].pos[r++])};this.color=t[0].color,this.width=t[0].width,requestAnimationFrame(i)}))}}(u,l,h,d);let m=[],f={},y=!1;const{password:g="秦丹",edit:v}=dan.querystring(location.search);console.log(g,v);let w=!!g&&void 0===v;const b="ontouchstart"in document.documentElement;if(w)(t=>{const e=tui.Toast.loading("");return axios.get("https://ff827abe-e27d-48d4-a09a-81355a2ce85d.bspapp.com/path/get",{params:t}).then((({status:t,data:e})=>{if(200===t&&e.data.length)return e.data[0];throw new Error(res)})).catch((()=>{tui.Toast.error("数据加载失败，请重试~")})).finally(e)})({password:g}).then((({path:t,background:e,title:o})=>(o&&(document.title=o),m=t,d=e,p.background=e,p.playPath(t).then((()=>{document.querySelector("#previewCover").classList.add("mask")}))))),document.querySelector("#previewCover").addEventListener("click",(function(t){if(p.isComplete)return this.classList.remove("mask"),p.playPath(m).then((()=>{document.querySelector("#previewCover").classList.add("mask")}));p.isPlay=!p.isPlay,p.isPlay?this.classList.remove("mask"):this.classList.add("mask")}),!1),document.querySelector(".toolbar").style.opacity=0,document.querySelector(".color-bar").style.opacity=0,document.querySelector(".width-bar").style.opacity=0;else{const t=b?"touchstart":"mousedown",e=b?"touchmove":"mousemove",o=b?"touchend":"mouseup",r=b?"touchcancel":"mouseleave";s.addEventListener(t,(function(t){if(w)return;y=!0;const{clientX:e,clientY:o}=b?t.touches[0]:t,r={x:e,y:o};p.color=l,p.width=h,f={width:p.width,color:p.color,pos:[r]},p.drawLine(e,o)}),!1),s.addEventListener(e,(function(t){if(y){const{clientX:e,clientY:o}=b?t.touches[0]:t;f.pos.push({x:e,y:o}),p.drawLine(e,o)}}),!1),s.addEventListener(o,k,!1),s.addEventListener(r,k,!1),document.querySelector("#previewCover").style.display="none"}function k(){y&&(y=!1,m.push(f),f={},p.end())}document.querySelector("#share").addEventListener("click",(function(t){if(!m.length)return tui.Toast.error("先随便画点什么吧~");const e=dan.random(8);a({password:e,path:m,background:p.background}).then((()=>{const t=location.origin+location.pathname+"?password="+e;console.log("share url",t),dan.copy(t),tui.Dialog({title:"提示",content:"链接已复制，赶紧去微信粘贴分享给小伙伴吧~\n"+t,buttons:[{text:"确定",onClick:async()=>dan.copy(t)}]})}))}),!1),document.querySelector("#clear").addEventListener("click",(function(t){w||(m=[],p.clear())}),!1),document.querySelector("#revoke").addEventListener("click",(function(t){w||(m.pop(),p.drawPath(m))}),!1),document.querySelector("#preview").addEventListener("click",(function(t){if(!w){if(!m.length)return tui.Toast.error("先随便画点什么吧~");w=!0,p.background=d,p.playPath(m).then((()=>{w=!1,document.querySelector("#previewCover").classList.add("mask")}))}}),!1),document.querySelector("#download").addEventListener("click",(function(t){if(!m.length)return tui.Toast.error("先随便画点什么吧~");!function(t,e=String(Date.now())){const o=document.createElement("a");o.download=e,o.href=t,o.click()}(s.toDataURL())}),!1),document.querySelector(".color-bar").addEventListener("click",(function(t){t.target.checked&&(l=t.target.value),console.log("e.target.value",t.target.value)}),!1),document.querySelector(".width-bar").addEventListener("click",(function(t){t.target.checked&&(h=t.target.value),console.log("e.target.value",t.target.value)}),!1),document.querySelector("#colorSelect").addEventListener("click",(t=>{t.stopPropagation()}),!1),document.querySelector("#backgroundSelect").addEventListener("click",(t=>{t.stopPropagation()}),!1),document.querySelector("#colorSelect").addEventListener("input",(function(t){l=t.target.value,this.nextElementSibling.style.color=l}),!1),document.querySelector("#backgroundSelect").addEventListener("input",(function(t){d=t.target.value,this.nextElementSibling.style.color=d,p.background=d,p.drawPath(m)}),!1);

var t=Object.defineProperty,e=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,i=(e,o,r)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r;const s=t=>{const s=tui.Toast.loading("");return axios.post("https://ff827abe-e27d-48d4-a09a-81355a2ce85d.bspapp.com/path/add",(a=((t,e)=>{for(var o in e||(e={}))n.call(e,o)&&i(t,o,e[o]);if(r)for(var o of r(e))c.call(e,o)&&i(t,o,e[o]);return t})({},t),l={createTime:Date.now()},e(a,o(l)))).finally(s);var a,l};const a=document.querySelector("#canvas");a.width=innerWidth,a.height=innerHeight;const l=a.getContext("2d"),d=new class{constructor(t){this.ctx=t,this.background="#fff",this.ctx.lineCap="round",this.ctx.lineJoin="round",this.width=6}set color(t){this.ctx.strokeStyle=t||"#000000"}get color(){return this.ctx.strokeStyle}set width(t){this.ctx.lineWidth=t||6}get width(){return this.ctx.lineWidth}set background(t){this.ctx.fillStyle=t||"#ffffff",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}get background(){return this.ctx.fillStyle}drawLine(t,e){return this.restarting&&(this.restarting=!1,this.ctx.moveTo(t,e),this.ctx.beginPath()),this.ctx.lineTo(t,e),this.ctx.stroke(),this}end(){return this.restarting=!0,this.ctx.closePath(),this}clear(){const{width:t,height:e}=this.ctx.canvas;this.ctx.clearRect(0,0,t,e)}drawPath(t){this.clear(),t.forEach((({pos:t})=>{t.forEach((({x:t,y:e})=>{this.drawLine(t,e)})),this.end()}))}}(l);let u=[],h={},p=!1;const{password:f="秦丹",edit:m}=dan.querystring(location.search);console.log(f,m);let g=!!f&&void 0===m;const y="ontouchstart"in document.documentElement;if(g)(t=>{const e=tui.Toast.loading("");return axios.get("https://ff827abe-e27d-48d4-a09a-81355a2ce85d.bspapp.com/path/get",{params:t}).then((({status:t,data:e})=>{if(200===t&&e.data.length)return e.data[0];throw tui.Toast.error("数据加载失败，请重试"),new Error(res)})).finally(e)})({password:f}).then((({path:t,background:e})=>(u=t,d.background=e,x(t)))),document.querySelector("#previewCover").addEventListener("click",(function(t){if(b)return this.classList.remove("mask"),x(u);w=!w,w?this.classList.remove("mask"):this.classList.add("mask")}),!1),document.querySelector(".toolbar").style.opacity=0,document.querySelector(".color-bar").style.opacity=0;else{const t=y?"touchstart":"mousedown",e=y?"touchmove":"mousemove",o=y?"touchend":"mouseup",r=y?"touchcancel":"mouseleave";a.addEventListener(t,(function(t){if(g)return;p=!0;const{clientX:e,clientY:o}=y?t.touches[0]:t,r={x:e,y:o};h={width:d.width,color:d.color,pos:[r]},d.drawLine(e,o)}),!1),a.addEventListener(e,(function(t){if(p){const{clientX:e,clientY:o}=y?t.touches[0]:t;h.pos.push({x:e,y:o}),d.drawLine(e,o)}}),!1),a.addEventListener(o,v,!1),a.addEventListener(r,v,!1),document.querySelector("#previewCover").style.display="none"}function v(){p=!1,u.push(h),h={},d.end()}let w=!1,b=!1;function x(t){return console.log("path",t),t.length?(w=!0,b=!1,d.clear(),new Promise(((e,o)=>{let r=0,n=0;const c=({x:t,y:e})=>{d.drawLine(t,e),requestAnimationFrame(i)},i=()=>{if(!w)return requestAnimationFrame(i);if(n>=t[r].pos.length){if(d.end(),!(++r<t.length))return b=!0,e();n=0,d.color=t[r].color,setTimeout((()=>{c(t[r].pos[n++])}),240)}else c(t[r].pos[n++])};d.color=t[0].color,requestAnimationFrame(i)})).then((()=>{document.querySelector("#previewCover").classList.add("mask")}))):Promise.resolve()}document.querySelector("#share").addEventListener("click",(function(t){if(!u.length)return tui.Toast.error("先随便画点什么吧~");const e=dan.random(8);s({password:e,path:u,background:d.background}).then((()=>{const t=location.origin+location.pathname+"?password="+e;console.log("share url",t),dan.copy(t),tui.Toast.success("链接已复制，赶紧去微信粘贴分享给小伙伴吧~")}))}),!1),document.querySelector("#clear").addEventListener("click",(function(t){g=!1,u=[],d.clear()}),!1),document.querySelector("#revoke").addEventListener("click",(function(t){u.pop(),d.drawPath(u)}),!1),document.querySelector("#preview").addEventListener("click",(function(t){if(!u.length)return tui.Toast.error("先随便画点什么吧~");g=!0,x(u).then((()=>{g=!1}))}),!1),document.querySelector("#download").addEventListener("click",(function(t){if(!u.length)return tui.Toast.error("先随便画点什么吧~");!function(t,e=String(Date.now())){const o=document.createElement("a");o.download=e,o.href=t,o.click()}(a.toDataURL())}),!1),document.querySelector(".color-bar").addEventListener("click",(function(t){t.target.checked&&(d.color=t.target.value)}),!1);

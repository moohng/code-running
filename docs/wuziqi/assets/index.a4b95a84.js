var t=Object.defineProperty,i=(i,h,e)=>(((i,h,e)=>{h in i?t(i,h,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[h]=e})(i,"symbol"!=typeof h?h+"":h,e),e);class h{constructor(t){this.color=t}draw(t,i,h,e=12){t.beginPath(),t.arc(i,h,e,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.closePath()}}function e(t,i,h=4){return[t-Math.min(t,h),t+Math.min(i-t-1,h)]}function s(t,i,h,e){let s=0;for(let n=t;n<=i;n++)if(e(n)){if(s++,s>=h)return!0}else s=0;return!1}function n(t,i,h,e){let s=0;for(let n=t.x,o=t.y;n<=i.x&&o<=i.y;n++,o++)if(e(n,o)){if(s++,s>=h)return!0}else s=0;return!1}const o=new class{constructor(t,h,e){i(this,"width",0),i(this,"height",0),this.instance=document.createElement("canvas");if((document.querySelector(t)||document.body).appendChild(this.instance),h&&e)this.width=h,this.height=e;else{const t=Math.min(window.innerWidth,window.innerHeight,768);this.width=t,this.height=t}this.instance.width=this.width,this.instance.height=this.height}get ctx(){var t;return null==(t=this.instance)?void 0:t.getContext("2d")}clear(){this.ctx.clearRect(0,0,this.width,this.height)}}("#chess"),r=new class{constructor(t,i=28){this.blankWidth=i,this.canvas=t,this.columnCount=Math.floor(this.canvas.width/this.blankWidth),this.rowCount=Math.floor(this.canvas.height/this.blankWidth),this.width=this.blankWidth*(this.columnCount-1),this.height=this.blankWidth*(this.rowCount-1),this.left=(this.canvas.width-this.width)/2,this.top=(this.canvas.height-this.height)/2,this.right=this.left+this.width,this.bottom=this.top+this.height,this.init(),this.canvas.instance.addEventListener("click",(({offsetX:t,offsetY:i})=>{if(!this.isStart)return;let e=Math.round((t-this.left)/this.blankWidth),s=Math.round((i-this.top)/this.blankWidth);if(e=e<0?0:e>this.columnCount?this.columnCount:e,s=s<0?0:s>this.rowCount?this.rowCount:s,console.log(e,s),!this.canDropdown(e,s))return void alert("落子无效！");new h(this.nextStep).draw(this.canvas.ctx,e*this.blankWidth+this.left,s*this.blankWidth+this.top),this.pieces.push([e,s]),this.cheeks[s][e]=this.nextStep,this.currentStep=this.nextStep,this.nextStep="black"===this.nextStep?"white":"black",this.calcResult(e,s)}))}init(){this.isStart=!1,this.pieces=[],this.nextStep="black",this.currentStep="black",this.cheeks=(()=>{const t=[];for(let i=0;i<this.rowCount;i++)t[i]=new Array(this.columnCount).fill(0);return t})()}draw(){const t=this.canvas.ctx;t.beginPath();for(let i=0;i<this.rowCount;i++){const h=this.top+i*this.blankWidth;t.moveTo(this.left,h),t.lineTo(this.right,h)}for(let i=0;i<this.columnCount;i++){const h=this.left+i*this.blankWidth;t.moveTo(h,this.top),t.lineTo(h,this.bottom)}t.stroke(),t.closePath()}start(){this.isStart=!0}reset(){this.canvas.clear(),this.init(),this.draw(),this.start()}canDropdown(t,i){return 0===this.cheeks[i][t]}calcResult(t,i){(this.left2right(t,i)||this.top2bottom(t,i)||this.leftTop2rightBottom(t,i)||this.leftBottom2rightTop(t,i))&&(alert("恭喜，"+this.currentStep+"获胜！"),location.reload())}left2right(t,i){const[h,n]=e(t,this.columnCount,4);return s(h,n,5,(t=>this.cheeks[i][t]===this.currentStep))}top2bottom(t,i){const[h,n]=e(i,this.rowCount,4);return s(h,n,5,(i=>this.cheeks[i][t]===this.currentStep))}leftTop2rightBottom(t,i){const h=Math.min(t,i,4),e=t-h,s=i-h,o=Math.min(this.columnCount-t-1,this.rowCount-i-1,4);return n({x:e,y:s},{x:t+o,y:i+o},5,((t,i)=>this.cheeks[i][t]===this.currentStep))}leftBottom2rightTop(t,i){const h=Math.min(t,this.rowCount-i-1,4),e=t-h,s=i+h,o=Math.min(this.columnCount-t-1,i,4),r=i-o;return n({x:e,y:r},{x:t+o,y:s},5,((t,i)=>this.cheeks[s-(i-r)][t]===this.currentStep))}}(o);r.draw(),document.querySelector("#startBtn").addEventListener("click",(()=>{document.querySelector("#cover").style.display="none",r.start()})),document.querySelector("#resetBtn").addEventListener("click",(()=>{r.reset()}));
